<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate AI Dungeon Master - All-in-One Edition</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Courier New', monospace; 
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #00ff00;
            overflow-x: hidden;
        }
        
        /* Main Menu Styles */
        .main-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        .menu-container {
            max-width: 900px;
            text-align: center;
            background: rgba(0, 0, 0, 0.8);
            padding: 40px;
            border-radius: 15px;
            border: 2px solid #00ff00;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
        }
        .main-title {
            font-size: 3.5em;
            margin-bottom: 0.5em;
            text-shadow: 0 0 20px #00ff00;
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 20px #00ff00; }
            to { text-shadow: 0 0 30px #00ff00, 0 0 40px #00ff00; }
        }
        .subtitle {
            font-size: 1.3em;
            margin-bottom: 2em;
            opacity: 0.8;
        }
        .mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .mode-card {
            background: rgba(0, 50, 0, 0.3);
            border: 2px solid #00aa00;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .mode-card:hover {
            background: rgba(0, 255, 0, 0.1);
            border-color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
            transform: translateY(-5px);
        }
        .mode-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #00ff00;
        }
        .mode-description {
            font-size: 0.9em;
            line-height: 1.4;
            opacity: 0.9;
        }
        
        /* Game Container Styles */
        .game-container {
            display: none;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .game-header {
            text-align: center;
            margin-bottom: 20px;
        }
        .game-title {
            font-size: 2.5em;
            text-shadow: 0 0 20px #00ff00;
            margin-bottom: 10px;
        }
        .game-stats {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: #cc0000;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
        }
        .back-btn:hover {
            background: #ff0000;
        }
        
        /* AI Panel Styles */
        .ai-panel {
            background: rgba(0, 50, 100, 0.8);
            border: 2px solid #0066ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            max-width: 500px;
            text-align: center;
        }
        .ai-label {
            color: #66ccff;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        /* Game Grid Styles */
        .game-grid {
            background: #000;
            border: 4px solid #00ff00;
            position: relative;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
        }
        .grid-bg {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            opacity: 0.1;
            background-image: 
                linear-gradient(90deg, #333 1px, transparent 1px),
                linear-gradient(#333 1px, transparent 1px);
        }
        .room { position: absolute; background: rgba(128, 128, 128, 0.3); }
        .wall { position: absolute; background: #555; }
        .item { 
            position: absolute; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-size: 20px;
            animation: pulse 2s infinite;
        }
        .enemy { 
            position: absolute; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-size: 20px;
        }
        .player { 
            position: absolute; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-size: 24px;
            z-index: 10;
            transition: all 0.15s ease;
        }
        .health-bar { 
            position: absolute; 
            top: 0; 
            left: 0; 
            height: 2px;
        }
        
        /* Controls Styles */
        .controls {
            margin-top: 20px;
            text-align: center;
        }
        .btn-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
            max-width: 400px;
        }
        .btn {
            padding: 12px 15px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-family: inherit;
        }
        .btn-move { background: #0066cc; color: white; }
        .btn-move:hover { background: #0088ff; }
        .btn-attack { background: #cc0000; color: white; }
        .btn-attack:hover { background: #ff0000; }
        .btn-item { background: #00cc00; color: white; }
        .btn-item:hover { background: #00ff00; }
        .btn-defend { background: #ccaa00; color: white; }
        .btn-defend:hover { background: #ffdd00; }
        .btn-special { background: #6600cc; color: white; }
        .btn-special:hover { background: #8800ff; }
        
        /* Mode Selector */
        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .mode-btn {
            padding: 8px 16px;
            background: rgba(0, 100, 0, 0.5);
            border: 1px solid #00aa00;
            color: #00ff00;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
        }
        .mode-btn:hover, .mode-btn.active {
            background: rgba(0, 255, 0, 0.2);
            border-color: #00ff00;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .main-title { font-size: 2.5em; }
            .mode-grid { grid-template-columns: 1fr; }
            .btn-grid { grid-template-columns: repeat(2, 1fr); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Loading Animation */
        .loading {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            z-index: 1000;
            text-align: center;
        }
        .spinner {
            border: 4px solid rgba(0, 255, 0, 0.3);
            border-top: 4px solid #00ff00;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading" style="display: none;">
        <div>üéÆ Loading Ultimate Dungeon Master...</div>
        <div class="spinner"></div>
    </div>

    <!-- Main Menu -->
    <div id="mainMenu" class="main-menu">
        <div class="menu-container">
            <h1 class="main-title">üéÆ Ultimate AI Dungeon Master</h1>
            <p class="subtitle">All-in-One Edition - Choose Your Adventure</p>
            
            <div class="mode-grid">
                <div class="mode-card" onclick="startGame('classic')">
                    <div class="mode-title">üïπÔ∏è Classic Mode</div>
                    <div class="mode-description">
                        Traditional dungeon crawler experience with retro pixel graphics.
                        Simple controls, collect items, avoid enemies!
                    </div>
                </div>
                
                <div class="mode-card" onclick="startGame('ai')">
                    <div class="mode-title">ü§ñ AI Enhanced Mode</div>
                    <div class="mode-description">
                        Full AI mentor system with real-time guidance, combat analysis,
                        and adaptive difficulty based on your performance.
                    </div>
                </div>
                
                <div class="mode-card" onclick="startGame('hardcore')">
                    <div class="mode-title">üíÄ Hardcore Mode</div>
                    <div class="mode-description">
                        Challenging gameplay with permadeath, limited resources,
                        and advanced enemy AI. For experienced players only!
                    </div>
                </div>
                
                <div class="mode-card" onclick="startGame('zen')">
                    <div class="mode-title">üßò Zen Mode</div>
                    <div class="mode-description">
                        Relaxed exploration mode with no combat, infinite health,
                        and focus on dungeon discovery and puzzle solving.
                    </div>
                </div>
                
                <div class="mode-card" onclick="startGame('speedrun')">
                    <div class="mode-title">‚ö° Speedrun Mode</div>
                    <div class="mode-description">
                        Race against time! Complete dungeons as fast as possible
                        with leaderboards and time challenges.
                    </div>
                </div>
                
                <div class="mode-card" onclick="startGame('custom')">
                    <div class="mode-title">üõ†Ô∏è Custom Mode</div>
                    <div class="mode-description">
                        Create your own dungeon layouts, set custom rules,
                        and design unique gameplay experiences.
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px; font-size: 0.9em; opacity: 0.7;">
                <p>üéÆ Use WASD/Arrow Keys for movement | Space: Attack | E: Use Item</p>
                <p>üí° Each mode offers unique features and gameplay mechanics</p>
            </div>
        </div>
    </div>

    <!-- Game Container -->
    <div id="gameContainer" class="game-container">
        <button class="back-btn" onclick="backToMenu()">‚Üê Back to Menu</button>
        
        <div class="game-header">
            <h1 id="gameTitle" class="game-title">üéÆ AI Dungeon Master</h1>
            <div class="game-stats">
                Level: <span id="level">1</span> | 
                Score: <span id="score">0</span> | 
                Health: <span id="health">100</span>/<span id="maxHealth">100</span>
                <span id="combat" style="color: #ff4444; display: none;"> ‚öîÔ∏è IN COMBAT!</span>
            </div>
        </div>

        <!-- Mode Selector -->
        <div class="mode-selector">
            <button class="mode-btn" onclick="switchDifficulty('easy')">Easy</button>
            <button class="mode-btn active" onclick="switchDifficulty('normal')">Normal</button>
            <button class="mode-btn" onclick="switchDifficulty('hard')">Hard</button>
            <button class="mode-btn" onclick="toggleAI()">AI: <span id="aiStatus">ON</span></button>
        </div>

        <!-- AI Panel -->
        <div id="aiPanel" class="ai-panel">
            <div class="ai-label">ü§ñ AI Mentor:</div>
            <div id="aiMessage">Welcome to the Ultimate AI-Enhanced Dungeon Master!</div>
        </div>

        <!-- Game Grid -->
        <div id="gameGrid" class="game-grid">
            <div class="grid-bg"></div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="btn-grid">
                <button class="btn btn-move" onclick="movePlayer(0, -1)">‚Üë Up</button>
                <button class="btn btn-attack" onclick="attack()">‚öîÔ∏è Attack</button>
                <button class="btn btn-item" onclick="useItem()">üß™ Item</button>
                <button class="btn btn-move" onclick="movePlayer(-1, 0)">‚Üê Left</button>
                <button class="btn btn-defend" onclick="defend()">üõ°Ô∏è Defend</button>
                <button class="btn btn-move" onclick="movePlayer(1, 0)">‚Üí Right</button>
                <button class="btn btn-move" onclick="movePlayer(0, 1)">‚Üì Down</button>
                <button class="btn btn-special" onclick="newDungeon()">üè∞ New Dungeon</button>
                <button class="btn btn-special" onclick="showStats()">üìä Stats</button>
            </div>
            
            <div style="color: #ccc; font-size: 12px; line-height: 1.4; margin-top: 15px;">
                <strong>Controls:</strong> WASD/Arrow Keys: Move | Space: Attack | E: Use Item<br>
                Shift: Defend | N: New Dungeon | Current Mode: <span id="currentMode">Classic</span>
            </div>
        </div>
    </div>

    <script>
        // Game Configuration
        const GRID_WIDTH = 20;
        const GRID_HEIGHT = 15;
        const CELL_SIZE = 32;
        
        // Game State
        let currentGameMode = 'classic';
        let difficulty = 'normal';
        let aiEnabled = true;
        let gameState = {
            player: { x: 3, y: 6, health: 100, maxHealth: 100 },
            enemies: [],
            items: [],
            rooms: [],
            walls: new Set(),
            level: 1,
            score: 0,
            isInCombat: false,
            timeStarted: Date.now(),
            movesCount: 0
        };

        // AI Messages by Mode
        const aiMessages = {
            classic: [
                'Good move! Stay alert for enemies.',
                'Exploring the dungeon wisely.',
                'Watch your surroundings, adventurer.',
                'The dungeon holds many secrets.',
                'Keep moving, but be cautious.'
            ],
            ai: [
                'Analyzing your movement patterns...',
                'Optimal path detected. Continue forward.',
                'Enemy behavior suggests flanking maneuver.',
                'Resource management is crucial here.',
                'Your combat efficiency is improving!'
            ],
            hardcore: [
                'Death is permanent. Proceed with extreme caution.',
                'Every decision matters in hardcore mode.',
                'Resources are scarce. Use them wisely.',
                'The enemies are more intelligent here.',
                'One mistake could end your journey.'
            ],
            zen: [
                'Take your time and enjoy the exploration.',
                'Focus on the beauty of the dungeon architecture.',
                'No rush - discover every secret.',
                'Peaceful exploration leads to inner wisdom.',
                'The journey is more important than the destination.'
            ],
            speedrun: [
                'Time is ticking! Move faster!',
                'Optimal route: straight to the treasure!',
                'Skip unnecessary items for better time.',
                'Current pace: excellent for world record!',
                'Every second counts in speedrun mode!'
            ]
        };

        // Game Mode Configurations
        const modeConfigs = {
            classic: {
                playerHealth: 100,
                enemyCount: 2,
                itemCount: 3,
                aiGuidance: false,
                permadeath: false,
                timeLimit: false
            },
            ai: {
                playerHealth: 100,
                enemyCount: 3,
                itemCount: 4,
                aiGuidance: true,
                permadeath: false,
                timeLimit: false
            },
            hardcore: {
                playerHealth: 50,
                enemyCount: 5,
                itemCount: 2,
                aiGuidance: true,
                permadeath: true,
                timeLimit: false
            },
            zen: {
                playerHealth: 999,
                enemyCount: 0,
                itemCount: 6,
                aiGuidance: false,
                permadeath: false,
                timeLimit: false
            },
            speedrun: {
                playerHealth: 100,
                enemyCount: 1,
                itemCount: 1,
                aiGuidance: true,
                permadeath: false,
                timeLimit: 300 // 5 minutes
            }
        };

        // Start Game Function
        function startGame(mode) {
            currentGameMode = mode;
            const config = modeConfigs[mode];
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            
            setTimeout(() => {
                // Hide menu, show game
                document.getElementById('mainMenu').style.display = 'none';
                document.getElementById('gameContainer').style.display = 'flex';
                document.getElementById('loading').style.display = 'none';
                
                // Update UI
                document.getElementById('gameTitle').textContent = `üéÆ ${mode.charAt(0).toUpperCase() + mode.slice(1)} Mode`;
                document.getElementById('currentMode').textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
                document.getElementById('aiPanel').style.display = config.aiGuidance ? 'block' : 'none';
                
                // Initialize game
                initializeGame(config);
                render();
                
                // Start timer for speedrun mode
                if (mode === 'speedrun') {
                    startSpeedrunTimer();
                }
            }, 1000);
        }

        // Initialize Game
        function initializeGame(config) {
            gameState = {
                player: { x: 3, y: 6, health: config.playerHealth, maxHealth: config.playerHealth },
                enemies: generateEnemies(config.enemyCount),
                items: generateItems(config.itemCount),
                rooms: generateRooms(),
                walls: new Set(),
                level: 1,
                score: 0,
                isInCombat: false,
                timeStarted: Date.now(),
                movesCount: 0
            };
            
            generateWalls();
            showAIMessage(getRandomAIMessage());
        }

        // Generate Functions
        function generateEnemies(count) {
            const enemies = [];
            for (let i = 0; i < count; i++) {
                enemies.push({
                    id: i + 1,
                    x: Math.floor(Math.random() * GRID_WIDTH),
                    y: Math.floor(Math.random() * GRID_HEIGHT),
                    health: difficulty === 'easy' ? 30 : difficulty === 'hard' ? 80 : 50,
                    type: Math.random() > 0.5 ? 'goblin' : 'orc'
                });
            }
            return enemies;
        }

        function generateItems(count) {
            const items = [];
            const types = ['potion', 'treasure', 'weapon', 'armor'];
            for (let i = 0; i < count; i++) {
                items.push({
                    id: i + 1,
                    x: Math.floor(Math.random() * GRID_WIDTH),
                    y: Math.floor(Math.random() * GRID_HEIGHT),
                    type: types[Math.floor(Math.random() * types.length)]
                });
            }
            return items;
        }

        function generateRooms() {
            return [
                { x: 2, y: 2, width: 6, height: 4 },
                { x: 10, y: 5, width: 8, height: 6 },
                { x: 5, y: 10, width: 10, height: 4 }
            ];
        }

        function generateWalls() {
            const walls = new Set();
            for (let x = 0; x < GRID_WIDTH; x++) {
                for (let y = 0; y < GRID_HEIGHT; y++) {
                    let isWall = true;
                    
                    // Check rooms
                    for (const room of gameState.rooms) {
                        if (x >= room.x && x < room.x + room.width &&
                            y >= room.y && y < room.y + room.height) {
                            isWall = false;
                            break;
                        }
                    }
                    
                    // Simple corridors
                    if ((x === 8 && y >= 4 && y <= 5) || 
                        (x === 7 && y >= 6 && y <= 10)) {
                        isWall = false;
                    }
                    
                    if (isWall) walls.add(`${x},${y}`);
                }
            }
            gameState.walls = walls;
        }

        // Movement and Actions
        function movePlayer(dx, dy) {
            const newX = gameState.player.x + dx;
            const newY = gameState.player.y + dy;
            
            if (isValidMove(newX, newY)) {
                gameState.player.x = newX;
                gameState.player.y = newY;
                gameState.movesCount++;
                
                checkItemCollection(newX, newY);
                checkCombat(newX, newY);
                
                if (aiEnabled) {
                    showAIMessage(getRandomAIMessage());
                }
                render();
            }
        }

        function isValidMove(x, y) {
            return x >= 0 && x < GRID_WIDTH && y >= 0 && y < GRID_HEIGHT && 
                   !gameState.walls.has(`${x},${y}`);
        }

        function checkItemCollection(x, y) {
            gameState.items = gameState.items.filter(item => {
                if (item.x === x && item.y === y) {
                    handleItemCollection(item);
                    return false;
                }
                return true;
            });
        }

        function handleItemCollection(item) {
            switch (item.type) {
                case 'potion':
                    gameState.player.health = Math.min(gameState.player.maxHealth, 
                                                     gameState.player.health + 20);
                    gameState.score += 10;
                    break;
                case 'treasure':
                    gameState.score += 50;
                    break;
                case 'weapon':
                    gameState.score += 25;
                    break;
                case 'armor':
                    gameState.player.maxHealth += 10;
                    gameState.player.health += 10;
                    gameState.score += 30;
                    break;
            }
        }

        function checkCombat(x, y) {
            const nearEnemy = gameState.enemies.find(e => 
                Math.abs(e.x - x) <= 1 && Math.abs(e.y - y) <= 1);
            gameState.isInCombat = !!nearEnemy;
        }

        function attack() {
            if (gameState.isInCombat) {
                const nearEnemy = gameState.enemies.find(e => 
                    Math.abs(e.x - gameState.player.x) <= 1 && 
                    Math.abs(e.y - gameState.player.y) <= 1);
                
                if (nearEnemy) {
                    const damage = difficulty === 'easy' ? 35 : difficulty === 'hard' ? 20 : 25;
                    nearEnemy.health -= damage;
                    
                    if (nearEnemy.health <= 0) {
                        gameState.enemies = gameState.enemies.filter(e => e.id !== nearEnemy.id);
                        gameState.score += 100;
                        gameState.isInCombat = false;
                        
                        if (currentGameMode === 'speedrun') {
                            showAIMessage('Quick kill! Excellent speedrun technique!');
                        }
                    }
                    
                    if (aiEnabled) {
                        showAIMessage(getRandomAIMessage());
                    }
                    render();
                }
            }
        }

        function useItem() {
            if (gameState.player.health < gameState.player.maxHealth) {
                gameState.player.health = Math.min(gameState.player.maxHealth, 
                                                 gameState.player.health + 30);
                if (aiEnabled) {
                    showAIMessage(getRandomAIMessage());
                }
                render();
            }
        }

        function defend() {
            if (aiEnabled) {
                showAIMessage('Defensive stance activated. Damage reduced for next turn.');
            }
        }

        function newDungeon() {
            gameState.level++;
            gameState.score += 100;
            gameState.player.x = 3;
            gameState.player.y = 6;
            
            const config = modeConfigs[currentGameMode];
            gameState.enemies = generateEnemies(config.enemyCount);
            gameState.items = generateItems(config.itemCount);
            
            generateWalls();
            
            if (aiEnabled) {
                showAIMessage('New dungeon generated! Adapt your strategy to the new layout.');
            }
            render();
        }

        // UI Functions
        function showAIMessage(message) {
            if (aiEnabled) {
                document.getElementById('aiMessage').textContent = message;
            }
        }

        function getRandomAIMessage() {
            const messages = aiMessages[currentGameMode] || aiMessages.classic;
            return messages[Math.floor(Math.random() * messages.length)];
        }

        function switchDifficulty(newDifficulty) {
            difficulty = newDifficulty;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Regenerate enemies with new difficulty
            const config = modeConfigs[currentGameMode];
            gameState.enemies = generateEnemies(config.enemyCount);
            render();
        }

        function toggleAI() {
            aiEnabled = !aiEnabled;
            document.getElementById('aiStatus').textContent = aiEnabled ? 'ON' : 'OFF';
            document.getElementById('aiPanel').style.display = aiEnabled ? 'block' : 'none';
        }

        function showStats() {
            const timePlayed = Math.floor((Date.now() - gameState.timeStarted) / 1000);
            const efficiency = gameState.movesCount > 0 ? Math.floor((gameState.score / gameState.movesCount) * 10) : 0;
            
            alert(`üìä Game Statistics:
            
Mode: ${currentGameMode.charAt(0).toUpperCase() + currentGameMode.slice(1)}
Difficulty: ${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)}
Level: ${gameState.level}
Score: ${gameState.score}
Time Played: ${timePlayed}s
Moves: ${gameState.movesCount}
Efficiency: ${efficiency}%
Enemies Defeated: ${modeConfigs[currentGameMode].enemyCount - gameState.enemies.length}
Items Collected: ${modeConfigs[currentGameMode].itemCount - gameState.items.length}`);
        }

        function backToMenu() {
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'flex';
        }

        // Speedrun Timer
        function startSpeedrunTimer() {
            const timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - gameState.timeStarted) / 1000);
                const remaining = 300 - elapsed; // 5 minutes
                
                if (remaining <= 0) {
                    clearInterval(timerInterval);
                    alert('‚è∞ Time\'s up! Speedrun failed. Try again for a better time!');
                    backToMenu();
                } else {
                    document.getElementById('gameTitle').textContent = 
                        `‚ö° Speedrun Mode - Time: ${Math.floor(remaining / 60)}:${(remaining % 60).toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        // Render Function
        function render() {
            // Update stats
            const levelEl = document.getElementById('level');
            const scoreEl = document.getElementById('score');
            const healthEl = document.getElementById('health');
            const maxHealthEl = document.getElementById('maxHealth');
            const combatEl = document.getElementById('combat');
            
            if (levelEl) levelEl.textContent = gameState.level;
            if (scoreEl) scoreEl.textContent = gameState.score;
            if (healthEl) healthEl.textContent = gameState.player.health;
            if (maxHealthEl) maxHealthEl.textContent = gameState.player.maxHealth;
            if (combatEl) combatEl.style.display = gameState.isInCombat ? 'inline' : 'none';
            
            // Clear and setup grid
            const grid = document.getElementById('gameGrid');
            if (!grid) return;
            
            grid.innerHTML = '<div class="grid-bg"></div>';
            grid.style.width = GRID_WIDTH * CELL_SIZE + 'px';
            grid.style.height = GRID_HEIGHT * CELL_SIZE + 'px';
            
            const bg = grid.querySelector('.grid-bg');
            bg.style.backgroundSize = `${CELL_SIZE}px ${CELL_SIZE}px`;
            
            // Render rooms
            gameState.rooms.forEach((room, i) => {
                const roomEl = document.createElement('div');
                roomEl.className = 'room';
                roomEl.style.left = room.x * CELL_SIZE + 'px';
                roomEl.style.top = room.y * CELL_SIZE + 'px';
                roomEl.style.width = room.width * CELL_SIZE + 'px';
                roomEl.style.height = room.height * CELL_SIZE + 'px';
                grid.appendChild(roomEl);
            });
            
            // Render walls
            gameState.walls.forEach(wall => {
                const [x, y] = wall.split(',').map(Number);
                const wallEl = document.createElement('div');
                wallEl.className = 'wall';
                wallEl.style.left = x * CELL_SIZE + 'px';
                wallEl.style.top = y * CELL_SIZE + 'px';
                wallEl.style.width = CELL_SIZE + 'px';
                wallEl.style.height = CELL_SIZE + 'px';
                grid.appendChild(wallEl);
            });
            
            // Render items
            gameState.items.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'item';
                itemEl.style.left = item.x * CELL_SIZE + 'px';
                itemEl.style.top = item.y * CELL_SIZE + 'px';
                itemEl.style.width = CELL_SIZE + 'px';
                itemEl.style.height = CELL_SIZE + 'px';
                
                const emojiMap = {
                    'potion': 'üß™', 'treasure': 'üí∞', 'weapon': '‚öîÔ∏è', 'armor': 'üõ°Ô∏è'
                };
                itemEl.textContent = emojiMap[item.type] || 'üß™';
                grid.appendChild(itemEl);
            });
            
            // Render enemies
            gameState.enemies.forEach(enemy => {
                const enemyEl = document.createElement('div');
                enemyEl.className = 'enemy';
                enemyEl.style.left = enemy.x * CELL_SIZE + 'px';
                enemyEl.style.top = enemy.y * CELL_SIZE + 'px';
                enemyEl.style.width = CELL_SIZE + 'px';
                enemyEl.style.height = CELL_SIZE + 'px';
                enemyEl.textContent = enemy.type === 'goblin' ? 'üëπ' : 'üßå';
                
                // Health bar
                const healthBar = document.createElement('div');
                healthBar.className = 'health-bar';
                healthBar.style.background = '#ff0000';
                healthBar.style.width = (enemy.health / 100) * CELL_SIZE + 'px';
                enemyEl.appendChild(healthBar);
                
                grid.appendChild(enemyEl);
            });
            
            // Render player
            const playerEl = document.createElement('div');
            playerEl.className = 'player';
            playerEl.style.left = gameState.player.x * CELL_SIZE + 'px';
            playerEl.style.top = gameState.player.y * CELL_SIZE + 'px';
            playerEl.style.width = CELL_SIZE + 'px';
            playerEl.style.height = CELL_SIZE + 'px';
            playerEl.textContent = 'üßô‚Äç‚ôÇÔ∏è';
            
            // Player health bar
            const playerHealthBar = document.createElement('div');
            playerHealthBar.className = 'health-bar';
            playerHealthBar.style.background = '#00ff00';
            playerHealthBar.style.height = '3px';
            playerHealthBar.style.width = (gameState.player.health / gameState.player.maxHealth) * CELL_SIZE + 'px';
            playerEl.appendChild(playerHealthBar);
            
            grid.appendChild(playerEl);
        }

        // Keyboard Controls
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('gameContainer').style.display === 'none') return;
            
            switch(e.key) {
                case 'ArrowUp': case 'w': case 'W':
                    e.preventDefault(); movePlayer(0, -1); break;
                case 'ArrowDown': case 's': case 'S':
                    e.preventDefault(); movePlayer(0, 1); break;
                case 'ArrowLeft': case 'a': case 'A':
                    e.preventDefault(); movePlayer(-1, 0); break;
                case 'ArrowRight': case 'd': case 'D':
                    e.preventDefault(); movePlayer(1, 0); break;
                case ' ': e.preventDefault(); attack(); break;
                case 'e': case 'E': e.preventDefault(); useItem(); break;
                case 'Shift': e.preventDefault(); defend(); break;
                case 'n': case 'N': e.preventDefault(); newDungeon(); break;
                case 'Escape': e.preventDefault(); backToMenu(); break;
            }
        });

        // Initialize
        console.log('üéÆ Ultimate AI Dungeon Master loaded successfully!');
    </script>
</body>
</html>